# Personal Project - SQL Sales Data Exploration

### The Prompt
As a business analyst for a fictional online retail company, use the customers, products, and sales data to find the following information for company stakeholders using SQL query techniques. Assume today is the beginning of Q3 in 2024 or July 01, 2024. 

1.	Find the **sales transactions made** in the last 30 days including customer name, product name, and total amount of the sale. Also find the total number of transactions, number of distinct customers, and total revenue during this period.
2.	Find the **total revenue generated by each product category** in 2023 from least to greatest.
3.	Find all **customers who made purchases** in 2023 and who are located in the West region so the marketing team can send them coupons for next quarter.
4.	Display the total number of transactions, total product quantity sold, and total revenue for each customer, in decreasing order by total revenue.
5.	Find the **top 3 customers by total revenue** in the year 2024 so they can receive Most Valuable Customer bonus products.
6.	**Rank products by their total sales quantity** in 2024 to identify the most popular items sold so far this year.
7.	Customers have the option of joining the Loyalty Program at any time. **Categorize customers** into "New", if their sign-up date for the Loyalty program is in the last 6 months or "Existing" otherwise. Where are most new loyalty program members located? 
8.	Find the **total transactions for each month** in the last 12 months (Q3 2023 through Q2 2024).
9.	Identify the **product categories that generated more than $4000** in revenue during the last 6 months (Q1 & Q2 of 2024). 
10.	Check for any sales where the total amount in the sales data doesn't match the expected value of the sale using quantity x price.

### The Data
For this project, I created my own dataset. I started with 26 fake products and randomly generated price values between $5 and $35 dollars, and assigning them to one of the 4 product categories. I then generated a list of 50 customers, evenly distributed between the 4 sales regions (West, East, North, South) and gave them Loyalty Program sign up dates between January 2023 and July 2024.

To create the sales dataset, I randomly selected from the 50 customers and 26 products to make the 400 purchases. For each purchase, I then randomly assigned a quantity between 1 and 5, and calculated the total amount of the sale using the prices in the products dataset. However, I altered 2 of the total amounts to be incorrect to allow me to later query for the errors using SQL. Finally, I assigned each transaction a sale date between January 2023 and July 2024.

The datasets are as follows-
  - "sales": A spreadsheet containing 400 sales made by the company identified by an id number.
    - id: the id for the sale
    - customer_id: the customer who made the purchase
    - product_id: what product was purchased
    - sale_date: the date of the sale
    - quantity: how many of the product was purchased
    - total_amount: the total amount of the sale in dollars
    
  - "customers": A spreadsheet containing information on 50 customers
    - customer_id: the customer's unique identifier
    - customer_name: the customer's first and last name
    - region: the sale region the customer is located in
    - sign_up_date: the date when the customer signed up for the Loyalty Program
    
  - "products": A spreadsheet containing information on the 26 products sold by the company
    - product_id: the unique id number of each product
    - product_name: The name of the product (I used the 26 letters of the alphabet to keep the data simple)
    - category: the category the product falls under, either Clothing, Food, Tech, or Toy
    - price: The price of the individual product

View the dataset on Google Sheets https://docs.google.com/spreadsheets/d/1yYP6ezcvZZwxVBvx_4axRNLDmKxd4JrIfo7IuKs3lak/edit?usp=sharing 

### The Process
  1. Find the **sales transactions made** in the last 30 days including customer name, product name, and total amount of the sale. Also find the total number of transactions, number of distinct customers, and total revenue during this period.
      - To find the sales in the last 30 days and the required information, I joined all three tables together and used a DATEDIFF function to include the last 30 days before July 1, 2024. I additionally had to cast my date values to the date type to ensure that DATEDIFF would properly interpret the values.
        ![image](https://github.com/user-attachments/assets/1e118746-7bcb-41b5-bcb7-deefc16d4342)

      - Using the query created above, I found the counts of transactions and distinct customers as well as the sum of the total amount of each transaction.
        ![image](https://github.com/user-attachments/assets/fb9cab4e-162f-480e-abd8-1c8720711fcf)

  2. Find the total revenue generated by each product category in 2023 from least to greatest.
       - Joining the product and sales tables allowed me to total the revenue made by each product category, ordering it appropriately from least to greatest revenue. I used the BETWEEN function to filter for dates in the year 2023.
         ![image](https://github.com/user-attachments/assets/205957bc-6874-475f-aee6-d577d026c483)

  3. Find all customers who made purchases in 2023 and who are located in the West region, so the marketing team can send them coupons for next quarter.
      - For this query, I created a subquery from the sales table that includes the customer_id and sale_date of all sales in 2023. I joined this data with the customers table, filtering for those in the West region. My first attempt at this query returned 29 customers from the west region, but I knew this was too many because there        are only 50 customers total, and I made the data so that there is roughly an equal amount of customers in each region. I changed the query to select DISTINCT                 customer_id in the West region to correct this issue. 
        ![image](https://github.com/user-attachments/assets/d249dabb-8d74-4df8-b1ea-58c8915aa841)

  4. Display the total number of transactions, total product quantity sold, and total revenue for each customer for 2023 & 2024, in decreasing order by total revenue. 
      - Joining the sales and customers tables together, I counted the number of transaction ids, total the quantity of each transaction and the total amount in USD, making sure to group by customer_id and ordering by total revenue. 
        ![image](https://github.com/user-attachments/assets/74356e42-d834-4259-9cb3-b8edb9c4c5e0)
        
In working this query, I discovered that there was one customer in the data that had an id number but not a name. I then decided to list out the transaction data for this customer for further review.
        ![image](https://github.com/user-attachments/assets/9231cf65-1f29-43f9-99a5-8568064a0998)

  5. Find the top 3 customers by total revenue in the first half of 2024 so they can receive Most Valuable Customer bonus products.
      - Since the sales data only contains transactions through the end of Quarter 2 in 2024, we can filter for just the year 2024 when identifying the top 3 customers. I grouped the transactions by customer id and summed the total revenue for each customer. Limiting the results to 3 rows after ordering from greatest to least, we can find the top 3 customers. If needed, we could join this result to the customers table to find the names of these  customers as well. 
       ![image](https://github.com/user-attachments/assets/3e9084e2-5c4b-4bf8-9c6c-0ac98e23bbd9)

  6. Rank products by their total sales quantity in 2024 to identify the most popular items sold so far this year.
      - First I created a common table expression called query to select only the data from the sales table that is from 2024. In the main query, I found the total quantity  sold of each product and ranked them so that the product that was sold the most is ranked #1. 
      ![image](https://github.com/user-attachments/assets/86a6766c-d9e4-4541-b690-97ac7f22b695)

  7. Customers have the option of joining the Loyalty Program at any time. Categorize customers into "New", if their sign-up date for the Loyalty program is in the last 6 months or "Existing" otherwise. Where are most new loyalty program members located?
       - This questions will take a few steps. First, we will need to use a DATEDIFF function to identify customer sign up dates within the last 6 months. Then using a CASE Function we can sort customers into "New" or "Existing" and create a new column in the result called "category". I made the categorized customer data into a common table expression called category_data. Then I can count the number of new customers that fall in each region and list the regions in order from most to least new customers.
         ![image](https://github.com/user-attachments/assets/33165b21-d913-419d-8952-fc70181ed2f7)

  8. Find the total transactions for each month in the last 12 months (Q3 2023 through Q2 2024). 
        - Because the last 12 months prior to the date given fall over two years, I decided to include both the year and month in my final result. Then I counted the number of ids in the sales table for each month. ordering them in calendar order to show the results. It looks like Q1 and Q2 of 2024 were busy months for the company.
          ![image](https://github.com/user-attachments/assets/b8da7386-1268-4f8f-a232-c1b949d7ef03)

  9. Identify the product categories that generated more than $4000 in revenue during the last 6 months (Q1 & Q2 of 2024). 
        - I used DATEDIFF again to find any transactions in the sales data from Q1 and Q2 of 2024. Grouping by product category and summing the total amount of the transactions is completed, and then I filtered the result to only show categories with a total revenue of more than $4000. 
         ![image](https://github.com/user-attachments/assets/45a7eae3-e549-4b6b-994c-6c0d7baa847d)

  10. Check for any sales where the total amount in the sales data doesn't match the expected value of the sale using quantity x price.
        -  For this problem, I purposefully changed to total_amount values in the sales table to be incorrect amounts. My goal is to find them. I calculated the expected value for each transaction by multiplying the quantity sold with the price of the product from the products table. Then I compared the total_amount listed in the sales table with this expected value and had the result return only rows where the two amounts did not match. 
          ![image](https://github.com/user-attachments/assets/672719c1-ecd2-4db9-93bf-bd37b0699d90)


### Results
1. There were 55 sales in the last 30 days made to 32 distinct customers for a total revenue of $3320.
2. In the last year, Tech products generated $1346, Clothing products generated $2573, Toy products generated $2708, and Food products generated $3016. Tech products are significantly underperforming the other categories.
3. In the West region, 11 distinct customers made purchases in 2023.
4. Evageline Ellis is the customer with the highest total revenue of `$`919 from buying 40 products in 14 separate transactions. Customer with ID #51 is missing a name in the data.
5. Customers with id numbers 10, 28, and 25 generated the most total revenue in the year 2024. 
6. Product A is the most popular item in 2024, by the end of Q2. It sold 50 times. A bonus observation is that all 26 products where sold in 2024 so far. 
7. The East and West region both had 2 customers join the Loyalty Program in the last 6 months. 
8. There has been an increase in total transactions in 2024, with small peaks in February and April, and the most transactions recorded in the most recent month, June 2024. 
9. The Clothing and Food product categories generated more than $4000 of revenue in Q1 and Q2 of 2024.
10. There are two sales with id numbers 29 and 53 where the total amount recorded for the sale does not match the expected value of the quanity of items sold times the price of the item sold. This may have been the result of a typo in data entry or a computer glitch at the time of purchase.

### Project Link 
https://www.datacamp.com/datalab/w/5c043c91-fde6-444e-b04f-010444555cc2/edit
