# Personal Project - SQL Sales Data Exploration

### The Prompt
As a business analyst for a fictional online retail company, use the customers, products, and sales data to find the following information for company stakeholders using SQL query techniques. 
  1. Assume today is November 10th, 2023. Find the sales made in the last 30 days including customer name, product name, and total amount of the sale.
  2. Find the total revenue generated by each product category in 2023 from least to greatest.
  3. Find all customers who made purchases in 2023 who are located in the West region.
  4. Display the total number of transactions, total product quantity sold, and total revenue for each customer, in decreasing order by total revenue.
  5. Find the top 3 customers by total revenue in the year 2023 so they can receive Most Valuable Customer bonus products.
  6. Rank products by their total sales quantity in 2023 to identify the most popular items sold that year.
  7. Assume today is August 15, 2023. Categorize customers into "New" (if they signed up in the last 6 months) or "Existing" based on their sign up date. Order by the region the customer is located in. Where are most new customers located?
  8. Assume today is May 1, 2024. Find the total transactions for each month in the last 12 months.
  9. Assume today is January 1, 2024. Identify the product categories that generated more than $1000 in revenue during the last 6 months.
  10. Check for any sales where the total amount in the sales data doesn't match the expected value of the sale using quantity x price.

### The Data
For this project, I created my own dataset. I started with 26 fake products and randomly generated price values between $5 and $35 dollars, and assigning them to one of the 4 product categories. I then generated a list of 50 customers, evenly distributed between the 4 sales regions (West, East, North, South) and evenly assigned sign up dates on the 1, 5, 15, 25 or 29 of the months in 2023.

To create the sales dataset, I randomly selected from the 50 customers and 26 products to make the 180 purchases. For each purchase, I then randomly assigned a quantity between 1 and 5, and calculated the total amount of the sale using the prices in the products dataset. However, I altered 2 of the total amounts to be incorrect to allow me to later query for the errors using SQL. Finally, I assigned each sale a sale date by adding 3 days to the customer's sign up date so that all the sale dates would be after the customer had joined the site.  

The datasets are as follows-
  - "sales": A spreadsheet containing 180 sales made by the company identified by an id number.
    - id: the id for the sale
    - customer_id: the customer who made the purchase
    - product_id: what product was purchased
    - sale_date: the date of the sale
    - quantity: how many of the product was purchased
    - total_amount: the total amount of the sale in dollars
    
  - "customers": A spreadsheet containing information on 50 customers
    - customer_id: the customer's unique identifier
    - customer_name: the customer's first and last name
    - region: the sale region the customer is located in
    - sign_up_date: the date when the customer signed up on the site
    
  - "products": A spreadsheet containing information on the 26 products sold by the company
    - product_id: the unique id number of each product
    - product_name: The name of the product (I used the 26 letters of the alphabet to keep the data simple)
    - category: the category the product falls under, either Clothing, Food, Tech, or Toy
    - price: The price of the individual product

View the dataset on Google Sheets https://docs.google.com/spreadsheets/d/1yYP6ezcvZZwxVBvx_4axRNLDmKxd4JrIfo7IuKs3lak/edit?usp=sharing 

### The Process
  1. Assume today is November 10th, 2023. Find the sales made in the last 30 days including customer name, product name, and total amount of the sale.
      - To find the sales in the last 30 days and the required information, I joined all three tables together and used a DATEDIFF function to include the last 30 days before November 10th. I additionally had to cast my date values to the date type to ensure that DATEDIFF would properly interpret the values.
        ![image](https://github.com/user-attachments/assets/231bedae-d315-4ab3-9ca2-312182104378)

  2. Find the total revenue generated by each product category in 2023 from least to greatest.
       - Joining the product and sales tables allowed me to total the revenue made by each product category, ordering it appropriately from least to greatest revenue. I used the BETWEEN function to filter for dates in the year 2023.
         ![image](https://github.com/user-attachments/assets/205957bc-6874-475f-aee6-d577d026c483)

  3. Find all customers who made purchases in 2023 who are located in the West region.
      - For this query, I created a subquery from the sales table that includes the customer_id and sale_date of all sales in 2023. I joined this data with the customers table, filtering for those in the West region. My first attempt at this query returned 29 customers from the west region, but I knew this was too many because there        are only 50 customers total, and I made the data so that there is roughly an equal amount of customers in each region. I changed the query to select DISTINCT                 customer_id in the West region to correct this issue. 
        ![image](https://github.com/user-attachments/assets/d249dabb-8d74-4df8-b1ea-58c8915aa841)

  4. Display the total number of transactions, total product quantity sold, and total revenue for each customer, in decreasing order by total revenue.
      - Joining the sales and customers tables together, I counted the number of transaction ids, total the quantity of each transaction and the total amount in USD, making sure to group by customer_id and ordering by total revenue. In working this query, I discovered that there was one customer in the data that had an id number but not a name. I then decided to list out the transaction data for this customer for further review.
        ![image](https://github.com/user-attachments/assets/e2a23eff-ed9b-402b-82e3-c4232bc0010c)
        
        ![image](https://github.com/user-attachments/assets/9231cf65-1f29-43f9-99a5-8568064a0998)

  5. Find the top 3 customers by total revenue in the year 2023 so they can receive Most Valuable Customer bonus products.
      - Using the sales data and filtering for sales in 2023, I grouped the transactions by customer id and summed the total revenue for each customer. Limiting the results to 3 rows after ordering from greatest to least, we can find the top 3 customers. If needed, we could join this result to the customers table to find the names of these  customers as well. 
        ![image](https://github.com/user-attachments/assets/cfd5b051-26b4-4b1c-85bb-d6d3767e5344)

  6. Rank products by their total sales quantity in 2023 to identify the most popular items sold that year.
      - First I created a common table expression called query to select only the data from the sales table that is from 2023. In the main query, I found the total quantity  sold of each product and ranked them so that the product that was sold the most is ranked #1. 
        ![image](https://github.com/user-attachments/assets/4359028c-ea25-47e7-b0e7-4df875b288d3)

  7. Assume today is August 15, 2023. Categorize customers into "New" (if they signed up in the last 6 months) or "Existing" based on their sign up date. Order by the region the customer is located in. Where are most new customers located?
       - This questions will take a few steps. First, we will need to use a DATEDIFF function to identify customer sign up dates within the last 6 months of August 15. Then   using a CASE Function we can sort customers into "New" or "Existing" and create a new column in the result called "category". I made the categorized customer data             into a common table expression called category_data. Then I can count the number of new customers that fall in each region and list the regions in order from most             to least new customers.
         ![image](https://github.com/user-attachments/assets/addd9731-d773-4208-b8a9-67009a33c7c9)
  
  8. Assume today is May 1, 2024. Find the total transactions for each month in the last 12 months.
        - Because the last 12 months prior to the date given fall over two years, I decided to include both the year and month in my final result. Then I counted the number of ids in the sales table for each month. ordering them in calendar order to show the results. It looks like Q3 and Q4 of 2023 where busy months for the company.
          ![image](https://github.com/user-attachments/assets/92bed36c-5945-48d7-9ed1-78727b93d2ec)

  9. Assume today is January 1, 2024. Identify the product categories that generated more than $1000 in revenue during the last 6 months.
        - I used DATEDIFF again to find any transactions in the sales data from Q3 and Q4 of 2023. Grouping by product category and summing the total amount of the transactions is completed, and then I filtered the result to only show categories with a total revenue of more than $1000. 
          ![image](https://github.com/user-attachments/assets/9d06082f-f56e-4967-9be4-ff0034f76ecc)

  10. Check for any sales where the total amount in the sales data doesn't match the expected value of the sale using quantity x price.
        -  For this problem, I purposefully changed to total_amount values in the sales table to be incorrect amounts. My goal is to find them. I calculated the expected value for each transaction by multiplying the quantity sold with the price of the product from the products table. Then I compared the total_amount listed in the sales table with this expected value and had the result return only rows where the two amounts did not match. 
          ![image](https://github.com/user-attachments/assets/672719c1-ecd2-4db9-93bf-bd37b0699d90)


### Results
1. There were 12 sales in the last 30 days before November 10th, 2023. The sales were made to three different customers.
2. In the last year, Tech products generated $1346, Clothing products generated $2573, Toy products generated $2708, and Food products generated $3016. Tech products are significantly underperforming the other categories.
3. In the West region, 11 distinct customers made purchases in 2023.
4. Gavyn Obrien is the customer with the highest total revenue of $707 from buying 27 products in 7 separate transactions. Customer with ID #51 is missing a name in the data.
5. Customers with id numbers 4, 12, and 46 generated the most total revenue in the year 2023.
6. Product S was the most popular item in 2023. It was sold 38 times. A bonus observation from this query is that all 26 products were sold at least 2 times in 2023.
7. Most new customers are located in the East region. The West region has the least new customers. 
8. In the last 12 months, there were peaks in transactions in August, October, and December 2023 - All with 15 transactions in the month.
9. The Clothing, Toy, and Food product categories generated more than $1000 of revenue in the last 6 months of 2023.
10.  There are two sales with id numbers 29 and 53 where the total amount recorded for the sale does not match the expected value of the quanity of items sold times the price of the item sold.

### Project Link 
https://www.datacamp.com/datalab/w/5c043c91-fde6-444e-b04f-010444555cc2/edit
